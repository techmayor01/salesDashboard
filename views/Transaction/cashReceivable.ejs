<!-- @format -->

<!DOCTYPE html>
<html lang="en">
  <%- include ('../partials/head') %>
  <body>
    <div class="relative flex flex-col min-h-screen bg-slate-200">
      <%- include ('../partials/header') %>

      <div class="flex flex-row">
        <div class="w-[220px] p-4"><%- include ('../partials/sidebar') %></div>
        <main
          class="cal relative top-16 p-4 overflow-auto"
          style="width: calc(100% - 220px)">
          <div class="flex flex-row justify-between items-center">
            <h1 class="text-2xl font-semibold">Cash Receivable</h1>
          </div>
          <div class="bg-white p-6 border border-gray-200">
            <div class="w-1/2">
              <!-- Search Customer -->
              <div class="flex gap-10 text-sm">
                <label class="block text-gray-700  mb-1 w-48"
                  >Search Customer <span class="text-red-500">*</span></label
                >
                <div class="w-full">
                  <input
                      id="customerSearch"
                      type="text"
                      placeholder="Search Customer"
                      class="w-full border border-green-500 p-2 mb-4" />

                    <ul id="customerList" class="border border-gray-200 mt-1 bg-white shadow-md absolute z-10 w-full hidden"></ul>

                    <div id="customerDetails" class="text-sm space-y-1 mt-2"></div>

                    <script>
                      const searchInput = document.getElementById('customerSearch');
                      const listEl = document.getElementById('customerList');
                      const detailsDiv = document.getElementById('customerDetails');

                      searchInput.addEventListener('input', function () {
                        const query = this.value.trim();

                        if (query.length < 2) {
                          listEl.classList.add('hidden');
                          detailsDiv.innerHTML = '';
                          return;
                        }

                        fetch(`/api/searchCustomers?q=${encodeURIComponent(query)}`)
                          .then(res => res.json())
                          .then(customers => {
                            if (customers.length === 0) {
                              listEl.classList.add('hidden');
                              listEl.innerHTML = '';
                              detailsDiv.innerHTML = '<p class="text-gray-500">No matching customer found.</p>';
                              return;
                            }

                            listEl.innerHTML = '';
                            customers.forEach((c, i) => {
                              const item = document.createElement('li');
                              item.textContent = `${c.customer_name} (${c.mobile})`;
                              item.className = "p-2 hover:bg-green-100 cursor-pointer";
                              item.addEventListener('click', () => {
                                searchInput.value = c.customer_name;
                                listEl.classList.add('hidden');
                                detailsDiv.innerHTML = `
                                  <h2 class="text-green-700 font-semibold text-lg mb-2">Payment Details:</h2>
                                  <div class="border-t border-green-500 mb-2"></div>
                                  <p><strong>Customers:</strong> ${c.customer_name}</p>
                                  <p><strong>Mobile:</strong> ${c.mobile}</p>
                                  <p><strong>Email:</strong> ${c.email}</p>
                                  <p><strong>Billing Address:</strong> ${c.address}</p>
                                  <div class="border-t-2 border-green-500 my-2"></div>
                                  <p><strong>Total Amount:</strong> ₦${c.total_amount ?? 0}</p>
                                  <p><strong>Paid Amount:</strong> ₦${c.paid_amount ?? 0}</p>
                                  <div class="border-t-2 border-green-500 my-2"></div>
                                  <p><strong>Remaining Amount:</strong> ₦${c.remaining_amount ?? 0}</p>
                                `;
                              });
                              listEl.appendChild(item);
                            });

                            listEl.classList.remove('hidden');
                          })
                          .catch(err => {
                            console.error('Search failed', err);
                          });
                      });
                    </script>

                </div>
              </div>

              <div class="flex gap-10 text-sm my-3">
                <!-- Cash Received -->
              <label class="block text-gray-700 font-medium mt-4 w-48"
                >Cash Received <span class="text-red-500">*</span></label
              >
              <div class="flex border border-green-500 overflow-hidden w-full">
                <span class="bg-green-200 text-white px-3 flex items-center"
                  >$</span
                >
                <input
                  type="number"
                  placeholder="Amount"
                  class="w-full p-2 border-none outline-none" />
              </div>
              </div>

              <div class="flex gap-10 text-sm my-3">
                <!-- Date -->
              <label class="block text-gray-700 font-medium mt-4 w-48"
                >Date <span class="text-red-500">*</span></label
              >
              <input
                type="date"
                class="w-full border border-green-500 p-2 " />
              </div>

              <div class="flex gap-10 text-sm my-3">
                <!-- Payment Type -->
              <label class="block text-gray-700 font-medium mt-4 w-48"
                >Payment Type <span class="text-red-500">*</span></label
              >
              <select class="w-full border border-green-500 p-2 rounded">
                <option>Select Payment Type</option>
                <option>Cash</option>
                <option>Credit Card</option>
                <option>Bank Transfer</option>
              </select>
              </div>

              <div class="flex gap-10 text-sm my-3">
                <div class="w-48"></div>
                <input
                type="text"
                placeholder="Payment Type Reference # / Detail"
                class="w-full border border-green-500 p-2  mt-2" />
              </div>

              <div class="flex gap-10 text-sm my-3">
                <div class="w-48"></div>
                <!-- Submit Button -->
              <button
                class="bg-green-500 text-white px-6 py-2  mt-4 w-full">
                Cash Received
              </button>
              </div>
              
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>
</html>
